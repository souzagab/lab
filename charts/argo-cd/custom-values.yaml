
global:
  domain: argo.g0b.dev

  params:
    ## Server properties
    # -- Run server without TLS
    ## NOTE: This value should be set when you generate params by other means as it changes ports used by ingress template.
    server.insecure: true

extraObjects:
- apiVersion: external-secrets.io/v1beta1
  kind: ExternalSecret
  metadata:
    name: argocd
    namespace: argocd
  spec:
    refreshInterval: "1800s"
    secretStoreRef:
      name: doppler
      kind: ClusterSecretStore
    target:
      name: argocd-secret
      creationPolicy: Merge
    data:
    - secretKey: admin.password
      remoteRef:
        key: ARGOCD_ADMIN_PASSWORD
- apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: argocd-server
    namespace: argocd
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      external-dns.alpha.kubernetes.io/hostname: argo.g0b.dev
      nginx.ingress.kubernetes.io/ssl-passthrough: "true"
  spec:
    ingressClassName: nginx
    tls:
    - hosts:
      - argo.g0b.dev
      secretName: g0b-dev-tls
    rules:
    - host: argo.g0b.dev
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: argo-cd-argocd-server # TODO: Understand and change argocd deployment
              port:
                name: http

## Application controller
controller:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack

dex:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack

redis:
  metrics:
    enabled: true

    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack


server:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack

repoServer:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack

applicationSet:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack

notifications:
  argocdUrl: "argo.g0b.dev"
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      selector:
        release: kube-prometheus-stack
